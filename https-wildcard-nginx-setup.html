<!DOCTYPE html> 
<html> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/rss+xml" title="Max Ogden Blogotronz (RSS 2.0)" href="http://maxogden.com/rss.xml">
  <title>Max Ogden Blogotronz</title> 
  
  <link href="styles/styles.css" media="screen" rel="stylesheet" type="text/css">
  <link href="styles/rainbow.github.css" media="screen" rel="stylesheet" type="text/css">

  <!-- libraries --> 
  <script src="script/jquery-1.6.1.min.js"></script>
  <script src="script/underscore.js"></script>
  <script src="script/d3.min.js"></script>
  <script src="script/voronoi.min.js"></script>
  <script src="script/rainbow.min.js"></script>
  <script src="script/rainbow.generic.js"></script>
  <script src="script/rainbow.javascript.js"></script>
  <script src="script/rainbow.css.js"></script>
  <script src="script/helpers.js"></script>
  
  <script src="script/application.js"></script>

</head>
<body> 
  <div id="container">
    <div class="header">
      <div class="title"><a href="https://github.com/maxogden" rel="me">Max Ogden</a> | Open Web programmer</div>
      <div class="subtitle"></div>
      <!-- THANKS, MICHAEL BOSTOCK! YOU RULE -->
      <div id="voronoi">
      </div>
      <div class="channel"></div>
      <div id="navigation">
        <div class="toggle home">
          <div class="navitem">
            <span rel="emojilock" style="letter-spacing: 3px;">📍🌍💩👼💊🍃🍷🍃🐊👅⛄️🎵🔋👊🐫🍁🐜🎂🐇🐣🐾👛📚👇🍟🐝🎲😭🎈🎊🙏🐜</span>
          </div>
        </div>
        <div class="toggle home">
          <div class="navitem">
            <a href="index.html">blog</a>
          </div>
        </div>
        <div class="toggle home">
          <div class="navitem">
            <a href="videos.html">media</a>
          </div>
        </div>
        <div class="toggle home">
          <div class="navitem">
            <a href="contact.html">contact</a>
          </div>
        </div>
      </div>
    </div>
    
    <div id="wrapper">
      <div id="browser">
        <div id="documents"><a class="load-document" href="node-distributed-systems.html">
  <div class="document" id="node-distributed-systems">
    <div class="published" data-published="2016-05-06T06:32:56.584Z">May 2016</div>
    <div class="title">Getting Started With Node For Distributed Systems</div>
    <div class="teaser">Where to get started with streams and peer to peer</div>
  </div>
</a>

<a class="load-document" href="iotjs-and-jerryscript.html">
  <div class="document" id="iotjs-and-jerryscript">
    <div class="published" data-published="2015-07-24T06:32:56.584Z">July 2015</div>
    <div class="title">What's the deal with iot.js and JerryScript</div>
    <div class="teaser">Node.js will soon be running on tiny low power chips</div>
  </div>
</a>

<a class="load-document" href="electron-fundamentals.html">
  <div class="document" id="electron-fundamentals">
    <div class="published" data-published="2015-07-23T06:32:56.584Z">July 2015</div>
    <div class="title">Electron Fundamentals</div>
    <div class="teaser">A quick intro to Electron, a desktop application runtime</div>
  </div>
</a>

<a class="load-document" href="hd-live-streaming-cats.html">
  <div class="document" id="hd-live-streaming-cats">
    <div class="published" data-published="2015-05-26T06:32:56.584Z">May 2015</div>
    <div class="title">HD Live Streaming Cats to YouTube with the Raspberry Pi Camera</div>
    <div class="teaser">A how to guide</div>
  </div>
</a>

<a class="load-document" href="interdisciplinary-open-source-events.html">
  <div class="document" id="interdisciplinary-open-source-events">
    <div class="published" data-published="2015-05-10T06:32:56.584Z">May 2015</div>
    <div class="title">Interdisciplinary Open Source Community Conferences</div>
    <div class="teaser">A list of community organized events</div>
  </div>
</a>

<a class="load-document" href="https-wildcard-nginx-setup.html">
  <div class="document active" id="https-wildcard-nginx-setup">
    <div class="published" data-published="2015-04-30T06:32:56.584Z">April 2015</div>
    <div class="title">Setting up HTTPS with a wildcard certificate and Nginx</div>
    <div class="teaser">How I set up HTTPS with Nginx</div>
  </div>
</a>

<a class="load-document" href="a-month-of-modules.html">
  <div class="document" id="a-month-of-modules">
    <div class="published" data-published="2015-04-30T03:32:56.584Z">April 2015</div>
    <div class="title">A Month of Modules</div>
    <div class="teaser">Modules Mafintosh and I wrote this month</div>
  </div>
</a>

<a class="load-document" href="tessel-powered-plant-watering-system.html">
  <div class="document" id="tessel-powered-plant-watering-system">
    <div class="published" data-published="2015-02-25T03:32:56.584Z">February 2015</div>
    <div class="title">Tessel Powered Plant Watering System</div>
    <div class="teaser">Make an HTTP accessible water pump</div>
  </div>
</a>

<a class="load-document" href="portland-fiber.html">
  <div class="document" id="portland-fiber">
    <div class="published" data-published="2015-02-01T03:32:56.584Z">January 2015</div>
    <div class="title">Portland Fiber Internet</div>
    <div class="teaser">Review of 1Gb fiber from CenturyLink</div>
  </div>
</a>

<a class="load-document" href="node-repl.html">
  <div class="document" id="node-repl">
    <div class="published" data-published="2015-01-24T23:04:02.791Z">January 2015</div>
    <div class="title">node-repl</div>
    <div class="teaser">An interactive console for node</div>
  </div>
</a>

<a class="load-document" href="nested-dependencies.html">
  <div class="document" id="nested-dependencies">
    <div class="published" data-published="2015-01-13T22:24:35.821Z">January 2015</div>
    <div class="title">Nested Dependencies</div>
    <div class="teaser">Insight into why node_modules works the way it does</div>
  </div>
</a>

<a class="load-document" href="node-packaged-modules.html">
  <div class="document" id="node-packaged-modules">
    <div class="published" data-published="2013-07-08T20:48:11.493Z">July 2013</div>
    <div class="title">Node Packaged Modules</div>
    <div class="teaser">Bringing NPM modules to the web</div>
  </div>
</a>

<a class="load-document" href="kindleberry-wireless.html">
  <div class="document" id="kindleberry-wireless">
    <div class="published" data-published="2013-03-24T20:48:11.493Z">March 2013</div>
    <div class="title">Kindleberry Wireless</div>
    <div class="teaser">A Portable Outdoor Hackstation</div>
  </div>
</a>

<a class="load-document" href="bringing-minecraft-style-games-to-the-open-web.html">
  <div class="document" id="bringing-minecraft-style-games-to-the-open-web">
    <div class="published" data-published="2013-01-25T20:48:11.493Z">January 2013</div>
    <div class="title">Bringing Minecraft-style games to the Open Web</div>
    <div class="teaser">A status report from the one month old voxel.js project</div>
  </div>
</a>

<a class="load-document" href="a-proposal-for-streaming-xhr.html">
  <div class="document" id="a-proposal-for-streaming-xhr">
    <div class="published" data-published="2012-11-20T20:48:11.493Z">November 2012</div>
    <div class="title">A Proposal For Streaming XHR</div>
    <div class="teaser">XHR2 isn't stream friendly. Lets explore why and propose a solution!</div>
  </div>
</a>

<a class="load-document" href="scraping-with-node.html">
  <div class="document" id="scraping-with-node">
    <div class="published" data-published="2012-10-24T20:48:11.493Z">October 2012</div>
    <div class="title">Scraping With Node</div>
    <div class="teaser">Useful modules and a tutorial on how to parse HTML with node.js</div>
  </div>
</a>

<a class="load-document" href="building-webview-applications.html">
  <div class="document" id="building-webview-applications">
    <div class="published" data-published="2012-10-15T20:48:11.493Z">October 2012</div>
    <div class="title">Building WebView Applications</div>
    <div class="teaser">Things I learned while building @gather</div>
  </div>
</a>

<a class="load-document" href="fast-webview-applications.html">
  <div class="document" id="fast-webview-applications">
    <div class="published" data-published="2012-05-31T20:48:11.493Z">May 2012</div>
    <div class="title">Fast WebView Applications</div>
    <div class="teaser">How to make web apps feel fast and responsive</div>
  </div>
</a>

<a class="load-document" href="node-streams.html">
  <div class="document" id="node-streams">
    <div class="published" data-published="2012-04-17T23:52:20.241Z">April 2012</div>
    <div class="title">Node Streams: How do they work?</div>
    <div class="teaser">Description of and notes on the node.js Stream API</div>
  </div>
</a>

<a class="load-document" href="gut-hosted-open-data-filets.html">
  <div class="document" id="gut-hosted-open-data-filets">
    <div class="published" data-published="2011-12-02T20:36:31.424Z">December 2011</div>
    <div class="title">Gut: Hosted Open Data Filet Knives</div>
    <div class="teaser">HTTP Unix pipes for Open Data</div>
  </div>
</a>

<a class="load-document" href="little-coders.html">
  <div class="document" id="little-coders">
    <div class="published" data-published="2011-07-17T02:56:48.555Z">July 2011</div>
    <div class="title">Little Coders</div>
    <div class="teaser">Elementary school programming</div>
  </div>
</a></div>
      </div>
      <div id="document"><div id="header"><h1 class="title">Setting up HTTPS with a wildcard certificate and Nginx</h1></div>

<p>How I set up HTTPS with Nginx, April 2015</p>
<p>I finally got a wildcard certificate for my new domain <code>publicbits.org</code>. This means I can use one cert for e.g. <code>https://foo.publicbits.org</code> or <code>https://bar.publicbits.org</code> but also <code>https://publicbits.org</code> or <code>https://www.publicbits.org</code>.</p>
<p>At the recommendation of my friend <a href="https://konklone.com/">Eric Mill</a> I decided to try out <a href="https://sslmate.com/">SSLMate</a>. Wildcard certs aren&#39;t cheap. From SSLMate it costs $149 USD. However, it was super easy compared to every other SSL purchasing experience I&#39;ve ever dealt with.</p>
<p>It should take about 20 minutes to do all the things in this blog post.</p>
<p>I have high hopes for <a href="https://letsencrypt.org">Let&#39;s Encrypt</a>, which will essentially make this process cost $0 instead of $149, but until then this is the easiest way to do it that I&#39;ve seen.</p>
<p>Note: my domain <code>maxogden.com</code> is hosted on GitHub Pages and they don&#39;t yet support HTTPS with custom domains. Email GitHub support and request this feature if it is important to you!</p>
<h2 id="installing-sslmate-and-buying-the-cert">Installing SSLMate and buying the cert</h2>
<p>First I <a href="https://sslmate.com/signup">signed up at SSLMate</a>. I picked a username and password and entered my payment info.</p>
<p>Then they have you install their <code>sslmate</code> CLI utility.</p>
<pre><code class="lang-sh">sudo wget -P /etc/apt/sources.list.d https://sslmate.com/apt/ubuntu1404/sslmate.list
sudo wget -P /etc/apt/trusted.gpg.d https://sslmate.com/apt/ubuntu1404/sslmate.gpg
sudo apt-get update
sudo apt-get install sslmate
</code></pre>
<p>Then you can buy a wildcard cert from the CLI:</p>
<pre><code class="lang-sh">sslmate buy *.publicbits.org
</code></pre>
<p>Then they ask you some questions, verify the order, purchase the cert and then send you an email. The email has instructions for verifying your ownership of the domain on a Comodo site. Turns out SSLMate is basically a user friendly front end to Comodo&#39;s positiveSSL service. I really appreciate how easy they make the process, and hope more SSL providers will follow suit!</p>
<p>Then I did <code>mkdir keys</code> and <code>cd keys</code>. I was now in <code>/home/max/keys</code>.</p>
<p>Next was <code>sslmate download --all</code>. Now a bunch of files appeared in my <code>keys</code> folder.</p>
<p>The ones I&#39;m using are <code>*.publicbits.org.key</code> and <code>*.publicbits.org.chained.crt</code>.</p>
<h2 id="installing-and-configuring-nginx">Installing and configuring Nginx</h2>
<p>Then I installed the latest Nginx. I have a utility I wrote last year called <a href="https://github.com/maxogden/install-nginx-on-ubuntu">install-nginx-on-ubuntu</a> that I used. It basically does this:</p>
<pre><code class="lang-sh">sudo apt-get install -y software-properties-common
sudo add-apt-repository -y ppa:nginx/stable
sudo apt-get update
sudo apt-get install -y nginx
sudo initctl start nginx
</code></pre>
<p>Then after lots of twiddling around with configs I ended up creating this &#39;default&#39; config and wrote it to <code>/etc/nginx/conf.d/ssl.conf</code>. It redirects all <code>http://</code> traffic to <code>https://</code>.</p>
<pre><code># redirect http -&gt; https
server {
  listen 80;
  server_name *.publicbits.org;
  return 301 https://$host$request_uri;
}  

# default config (server_name _; makes this &#39;base&#39; config)
server {
  listen 443 default ssl;
  server_name _;

  ssl_certificate_key /home/max/keys/*.publicbits.org.key;
  ssl_certificate /home/max/keys/*.publicbits.org.chained.crt;

  # These this next block of settings came directly from the SSLMate recommend nginx configuration
  # Recommended security settings from https://wiki.mozilla.org/Security/Server_Side_TLS
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers &#39;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA&#39;;
  ssl_prefer_server_ciphers on;
  ssl_session_timeout 5m;
  ssl_session_cache shared:SSL:5m;
  # Enable this if you want HSTS (recommended)
  add_header Strict-Transport-Security max-age=15768000;

  # from https://gist.github.com/konklone/6532544
  # Generated by OpenSSL with the following command:
  #   openssl dhparam -outform pem -out dhparam2048.pem 2048
  ssl_dhparam /home/max/keys/dhparam2048.pem;
}
</code></pre><p>Make sure you run <code>openssl dhparam -outform pem -out dhparam2048.pem 2048</code> inside your <code>keys</code> folder (it will take a while).</p>
<h2 id="deploying-processes">Deploying processes</h2>
<p>Then I use <a href="https://www.npmjs.com/package/taco-nginx">taco-nginx</a> to deploy individual processes:</p>
<pre><code>taco-nginx --name signalhub signalhub listen -m 10
</code></pre><p><code>taco-nginx</code> takes care of generating a configuration for my app and then reloading nginx. For the above command the configuration file it generated is <code>/etc/nginx/conf.d/signalhub.conf</code> with the contents:</p>
<pre><code># generated by taco-nginx
upstream signalhub {
  server 127.0.0.1:54082;
}

server {
  listen 443;
  server_name signalhub.*;
  location / {
    proxy_pass http://signalhub;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_buffering off;
    proxy_request_buffering off;
    proxy_http_version 1.1;
  }
}
</code></pre><p>With this configuration I can deploy new apps with <code>taco-nginx</code> quickly without having to configure them for HTTPS, since Nginx can reverse proxy HTTPS -&gt; HTTP. </p>
<p>My <a href="https://www.ssllabs.com/ssltest/analyze.html?d=signalhub.publicbits.org">score on SSLLabs</a> is an A:</p>
<p><img src="media/ssllabs.png" alt="ssl labs"></p>
<p>Thanks a ton to <a href="https://konklone.com">Eric Mill</a> for helping tweak my HTTPS settings and <a href="https://github.com/mafintosh">Mathias Buus</a> for helping with Nginx.</p>
</div>
    </div>
  </div>  
  
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24933665-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body> 
</html>
